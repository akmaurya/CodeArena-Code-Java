/*
 * To change this template, choose Tools | Templates
 * and open the template in the editor.
 */

/*
 * LoadFinancialYear.java
 *
 * Created on Apr 9, 2012, 5:27:17 PM
 */

package p3;

import java.awt.Dimension;
import p3.Login;
import p3.Main;
import p3.getIPaddress;
import p3.interfaceRailway;

/**
 *
 * @author pratiksha
 */
public class LoadFinancialYear extends javax.swing.JDialog {

    /** Creates new form LoadFinancialYear */
    public LoadFinancialYear() {
        initComponents();
        jComboBox1.removeAllItems();
        System.out.println("LoadFinancialYear");
        loadInitialInfo();
        try
        {
        String path=new java.io.File("").getCanonicalPath();
        System.out.println("1......."+path);
        }
        catch(Exception e)
        {
            
        }
        
        this.getContentPane().setBackground(new java.awt.Color(154,238,166));
       //setDefaultCloseOperation(DO_NOTHING_ON_CLOSE);
    }

    /** This method is called from within the constructor to
     * initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is
     * always regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        jPanel2 = new javax.swing.JPanel();
        jPanel1 = new javax.swing.JPanel();
        jLabel2 = new javax.swing.JLabel();
        jComboBox2 = new javax.swing.JComboBox();
        jLabel1 = new javax.swing.JLabel();
        jComboBox1 = new javax.swing.JComboBox();
        jButton2 = new javax.swing.JButton();
        jButton1 = new javax.swing.JButton();
        jButton3 = new javax.swing.JButton();

        setTitle("Financial Year");
        setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));

        jPanel2.setBackground(new java.awt.Color(102, 102, 102));
        jPanel2.setBorder(javax.swing.BorderFactory.createCompoundBorder(new javax.swing.border.SoftBevelBorder(javax.swing.border.BevelBorder.RAISED), javax.swing.BorderFactory.createEtchedBorder(javax.swing.border.EtchedBorder.RAISED)));
        jPanel2.setLayout(null);

        jPanel1.setBackground(new java.awt.Color(252, 252, 246));
        jPanel1.setBorder(javax.swing.BorderFactory.createCompoundBorder(new javax.swing.border.LineBorder(new java.awt.Color(0, 0, 0), 5, true), javax.swing.BorderFactory.createTitledBorder("")));
        jPanel1.setLayout(null);

        jLabel2.setBackground(new java.awt.Color(153, 255, 255));
        jLabel2.setFont(new java.awt.Font("Verdana", 1, 14));
        jLabel2.setText("Select Finanacial Year");
        jPanel1.add(jLabel2);
        jLabel2.setBounds(20, 100, 180, 30);

        jComboBox2.setFont(new java.awt.Font("Verdana", 1, 14));
        jComboBox2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jComboBox2ActionPerformed(evt);
            }
        });
        jComboBox2.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jComboBox2FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jComboBox2FocusLost(evt);
            }
        });
        jComboBox2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jComboBox2KeyPressed(evt);
            }
        });
        jPanel1.add(jComboBox2);
        jComboBox2.setBounds(210, 100, 100, 30);

        jLabel1.setFont(new java.awt.Font("Verdana", 1, 14));
        jLabel1.setText("Select Company Name");
        jPanel1.add(jLabel1);
        jLabel1.setBounds(20, 40, 180, 30);

        jComboBox1.setFont(new java.awt.Font("Verdana", 1, 14));
        jComboBox1.setModel(new javax.swing.DefaultComboBoxModel(new String[] { "Item 1", "Item 2", "Item 3", "Item 4" }));
        jComboBox1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jComboBox1KeyPressed(evt);
            }
        });
        jPanel1.add(jComboBox1);
        jComboBox1.setBounds(210, 40, 360, 30);

        jButton2.setFont(new java.awt.Font("Verdana", 1, 14));
        jButton2.setText("Select");
        jButton2.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton2ActionPerformed(evt);
            }
        });
        jButton2.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jButton2FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jButton2FocusLost(evt);
            }
        });
        jButton2.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jButton2KeyPressed(evt);
            }
        });
        jPanel1.add(jButton2);
        jButton2.setBounds(330, 98, 120, 32);

        jButton1.setFont(new java.awt.Font("Verdana", 1, 14));
        jButton1.setText("Cancel");
        jButton1.setCursor(new java.awt.Cursor(java.awt.Cursor.DEFAULT_CURSOR));
        jButton1.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton1ActionPerformed(evt);
            }
        });
        jButton1.addFocusListener(new java.awt.event.FocusAdapter() {
            public void focusGained(java.awt.event.FocusEvent evt) {
                jButton1FocusGained(evt);
            }
            public void focusLost(java.awt.event.FocusEvent evt) {
                jButton1FocusLost(evt);
            }
        });
        jButton1.addKeyListener(new java.awt.event.KeyAdapter() {
            public void keyPressed(java.awt.event.KeyEvent evt) {
                jButton1KeyPressed(evt);
            }
        });
        jPanel1.add(jButton1);
        jButton1.setBounds(460, 98, 110, 32);

        jButton3.setFont(new java.awt.Font("Tahoma", 1, 12));
        jButton3.setText("Create New Company");
        jButton3.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                jButton3ActionPerformed(evt);
            }
        });
        jPanel1.add(jButton3);
        jButton3.setBounds(20, 230, 550, 23);

        jPanel2.add(jPanel1);
        jPanel1.setBounds(20, 20, 590, 270);

        getContentPane().add(jPanel2, java.awt.BorderLayout.CENTER);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void jComboBox2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jComboBox2ActionPerformed
        // TODO add your handling code here:
}//GEN-LAST:event_jComboBox2ActionPerformed

    private void jComboBox2FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jComboBox2FocusGained
        // TODO add your handling code here:
        jComboBox2.setBackground(java.awt.Color.yellow);
}//GEN-LAST:event_jComboBox2FocusGained

    private void jComboBox2FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jComboBox2FocusLost
        // TODO add your handling code here:
        jComboBox2.setBackground(java.awt.Color.white);
}//GEN-LAST:event_jComboBox2FocusLost

    private void jComboBox2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jComboBox2KeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==java.awt.event.KeyEvent.VK_ENTER) {
            jButton2.requestFocus();
        }
}//GEN-LAST:event_jComboBox2KeyPressed

    private void jButton2ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton2ActionPerformed
        // TODO add your handling code here:
        selectYear();
}//GEN-LAST:event_jButton2ActionPerformed

    private void jButton2FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jButton2FocusGained
        // TODO add your handling code here:
        jButton2.setBackground(java.awt.Color.yellow);
}//GEN-LAST:event_jButton2FocusGained

    private void jButton2FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jButton2FocusLost
        // TODO add your handling code here:
        jButton2.setBackground(java.awt.Color.white);
}//GEN-LAST:event_jButton2FocusLost

    private void jButton2KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jButton2KeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==java.awt.event.KeyEvent.VK_ENTER) {
            selectYear();
        }
}//GEN-LAST:event_jButton2KeyPressed

    private void jButton1ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton1ActionPerformed
        // TODO add your handling code here:
        System.exit(0);
}//GEN-LAST:event_jButton1ActionPerformed

    private void jButton1FocusGained(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jButton1FocusGained
        // TODO add your handling code here:
        jButton1.setBackground(java.awt.Color.yellow);
}//GEN-LAST:event_jButton1FocusGained

    private void jButton1FocusLost(java.awt.event.FocusEvent evt) {//GEN-FIRST:event_jButton1FocusLost
        // TODO add your handling code here:
        jButton1.setBackground(java.awt.Color.white);
}//GEN-LAST:event_jButton1FocusLost

    private void jButton1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jButton1KeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==10)
            System.exit(0);
}//GEN-LAST:event_jButton1KeyPressed

    private void jComboBox1KeyPressed(java.awt.event.KeyEvent evt) {//GEN-FIRST:event_jComboBox1KeyPressed
        // TODO add your handling code here:
        if(evt.getKeyCode()==10)
        {
            jComboBox2.requestFocus();
        }
    }//GEN-LAST:event_jComboBox1KeyPressed

    private void jButton3ActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_jButton3ActionPerformed
        // TODO add your handling code here:
        createCompany();
    }//GEN-LAST:event_jButton3ActionPerformed


    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton jButton1;
    private javax.swing.JButton jButton2;
    private javax.swing.JButton jButton3;
    private javax.swing.JComboBox jComboBox1;
    private javax.swing.JComboBox jComboBox2;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    private javax.swing.JPanel jPanel1;
    private javax.swing.JPanel jPanel2;
    // End of variables declaration//GEN-END:variables
javax.swing.JDesktopPane dp;


private void loadInitialInfo()
{
    try
    {

        	//interfaceRailway object1=(interfaceRailway)java.rmi.Naming.lookup("rmi://127.0.0.1/railwayMethods");
                interfaceRailway object1=null;
                System.out.println("in loadInitial");
		try
		{
			object1=(interfaceRailway)java.rmi.Naming.lookup(getIPaddress.IP());
		}
		catch(Exception e)
		{
				System.out.println("Error at the time of connection with server "+getIPaddress.IP()+"..."+e);
				getIPaddress.changeIP();
				try
				{
					object1=(interfaceRailway)java.rmi.Naming.lookup(getIPaddress.IP());
				}
				catch(Exception ex)
				{
					System.out.println("Error at the time of connection with server ip-rmi//127.0.0.1/railwayMethods  ..."+ex);
				}
		}
                System.out.println("going for fun");
                String fname=object1.returnFinancialYears();
                System.out.println("fname............."+fname);

                while(fname.length()>0)
                {
                    //javax.swing.JOptionPane.showMessageDialog(null,"coming here.");
                     	String temp=fname.substring(0,fname.indexOf(';'));
                        String temp1="";
                        String temp2="";
                        String temp3="";
                        String cname="";
                        System.out.println("temp="+temp);
                      	fname=fname.substring(fname.indexOf(';')+1,fname.length());
                        //System.out.println("fname="+fname);
                       	try
                       	{
                                temp1=temp;
                      	        temp=temp.substring(temp.length()-4,temp.length());
                                System.out.println("temp.............."+temp);
                                cname=temp1.substring(0,temp1.length()-4);
                                System.out.println("cname.............."+cname);
                       		Integer.parseInt(temp);
                                temp2=temp.substring(0, 2);
                                temp3=temp.substring(2, temp.length());
                       		jComboBox2.addItem(temp2+"-"+temp3);
                                System.out.println("jComboBox2.getSelectedItem()="+jComboBox2.getSelectedItem());
                                jComboBox1.addItem(cname);
                       	}
                       	catch(Exception y)
                       	{
                                System.out.println("Error ! In loadInitialnfo"+y);
                       	}
                }

    }
    catch(Exception e)
    {
        System.out.println("Error ! In loadInitialInfo Method "+e);
    }

}
private void selectYear()
{
    try
    {
                  String tmp1[]=jComboBox2.getSelectedItem().toString().split("-");
                  //String tmp
                  String finyear=tmp1[0]+tmp1[1];
                  System.out.println("finyear="+finyear);
                  Main.year=finyear;
                  String CompanyName=jComboBox1.getSelectedItem().toString();
                  Main.cname=CompanyName;
                  System.out.println("finyear............."+finyear+"   CompanyName............."+CompanyName);
                  //javax.swing.JOptionPane.showMessageDialog(null,finyear+"   year i
                  
//                  setTitle("Running Financial Year : "+finyear.substring(0,2)+"-"+finyear.substring(2,4));
               //   interfaceRailway object1=(interfaceRailway)java.rmi.Naming.lookup("rmi://127.0.0.1/railwayMethods");

                interfaceRailway object1=null;
		try
		{
			object1=(interfaceRailway)java.rmi.Naming.lookup(getIPaddress.IP());
		}
		catch(Exception e)
		{
				System.out.println("Error at the time of connection with server "+getIPaddress.IP()+"..."+e);
				getIPaddress.changeIP();
				try
				{
					object1=(interfaceRailway)java.rmi.Naming.lookup(getIPaddress.IP());
				}
				catch(Exception ex)
				{
					System.out.println("Error at the time of connection with server ip-rmi//127.0.0.1/railwayMethods  ..."+ex);
				}
		}        
                //  javax.swing.JOptionPane.showMessageDialog(null,"generating...."+object1);
                  
                  boolean bn=object1.selectFinancialYear(CompanyName,finyear);
                  if(bn)
                  {
                
                        //javax.swing.JOptionPane.showMessageDialog(null,"Coming here...b.........");
                    /*    LoginWindow LW=new LoginWindow();
                        dp.add(LW);
                        LW.setBounds(100,100,400,257);//400, 257
                        LW.show();
                        this.dispose();
                   */
                      this.dispose();
                     // javax.swing.JOptionPane.showMessageDialog(null,"Come In Side.");
                      Login frm=new Login(null,true,finyear,CompanyName);
                      frm.setSize(new Dimension(530, 385));
                      frm.setLocationRelativeTo(null);
                      frm.setVisible(true);

                  }
    }
    catch(Exception e)
    {
        System.out.println("Error ! In selectYear Method...."+e);
    }

}
public void createCompany()
{
    try
    {
              interfaceRailway object1=null;
		try
		{
			object1=(interfaceRailway)java.rmi.Naming.lookup(getIPaddress.IP());
		}
		catch(Exception e)
		{
				System.out.println("Error at the time of connection with server "+getIPaddress.IP()+"..."+e);
				getIPaddress.changeIP();
				try
				{
					object1=(interfaceRailway)java.rmi.Naming.lookup(getIPaddress.IP());
				}
				catch(Exception ex)
				{
					System.out.println("Error at the time of connection with server ip-rmi//127.0.0.1/railwayMethods  ..."+ex);
				}
		}
              String str=javax.swing.JOptionPane.showInputDialog(this, "Please enter admin password!","User Verification",javax.swing.JOptionPane.OK_CANCEL_OPTION);
              System.out.println("admin password="+str);
              String qry="select user_pass from loginmaster where user_level="+0+"";
              String data=object1.getSigetngleValue(qry, Main.year);
              if(data.length()>0)
              {
                  if(data.equals(str))
                  {
                      
                  }
              }
    }
    catch(Exception e)
    {
        System.out.println("Error ! In selectYear Method...."+e);
    }
}
}